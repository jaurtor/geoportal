<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Visor MeteorolÃ³gico</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- Header con tÃ­tulo -->
  <div class="header-title">
    <h1>Visor MeteorolÃ³gico</h1>
    <p class="subtitle">Comunidad Valenciana - 14 Mayo 2023</p>
    <p class="author">Por <span class="author-name">Javier Urrecho</span></p>
  </div>

  <div id="map"></div>
  
  <div id="pixelDisplay">
    <div id="pixelUnit">-</div>
    <div id="pixelDisplayValue">-</div>
  </div>

  <div class="measure-panel" id="measurePanel">
    <h3>ğŸ“ Medir Distancia</h3>
    <div class="measure-instruction" id="measureInstruction">Haz clic en dos puntos del mapa</div>
    <div class="measure-result" id="measureResult">-</div>
    <div class="btn-group" style="margin-top: 10px;">
      <button id="clearMeasureBtn" style="flex: none; padding: 6px 12px;">Borrar</button>
      <button id="closeMeasureBtn" style="flex: none; padding: 6px 12px;">Cerrar</button>
    </div>
  </div>

  <div class="coords-panel">
    <div class="coords-content">
      <select class="projection-select" id="projectionSelect">
        <option value="4326">EPSG:4326 (WGS84)</option>
        <option value="25830">EPSG:25830 (UTM30N)</option>
        <option value="3857">EPSG:3857 (Web Mercator)</option>
      </select>
      <div class="coord-row">
        <span class="coord-label">Latitud/X:</span>
        <span class="coord-value" id="coordX">0.0000</span>
      </div>
      <div class="coord-row">
        <span class="coord-label">Longitud/Y:</span>
        <span class="coord-value" id="coordY">0.0000</span>
      </div>
    </div>
  </div>

  <div class="compass" id="compassBtn" title="Restablecer orientaciÃ³n">
    <span>N<br>â¬†</span>
  </div>
  
  <div class="control-panel">
    <div class="section">
      <h3>ğŸ—ºï¸ Capas Vectoriales</h3>
      <div class="status" id="vectorStatus">Cargando datos...</div>
      <div class="legend">
        <div class="legend-title">Estaciones AEMET</div>
        <div style="display: flex; align-items: center; gap: 8px; margin-top: 8px;">
          <div style="width: 12px; height: 12px; border-radius: 50%; background: #58a6ff; border: 2px solid #238636;"></div>
          <span style="font-size: 11px;">EstaciÃ³n meteorolÃ³gica</span>
        </div>
      </div>
    </div>

    <div class="section">
      <h3>ğŸŒ Capas Raster</h3>
      <div class="btn-group">
        <button class="raster-btn" data-layer="20230514_meantemperature_comvalenciana">ğŸŒ¡ï¸ Temp</button>
        <button class="raster-btn" data-layer="20230514_precipitation_comvalenciana">ğŸŒ§ï¸ Precip</button>
      </div>
      <div class="status" id="rasterStatus">Selecciona una capa</div>
      
      <div class="legend hidden" id="rasterLegend">
        <div class="legend-title" id="legendTitle"></div>
        <div class="legend-gradient" id="legendGradient"></div>
        <div class="legend-scale" id="legendScale"></div>
      </div>
      
      <div class="slider-control" id="opacityControl">
        <label>
          Transparencia:
          <input type="range" id="opacitySlider" min="0" max="100" value="80">
          <span id="opacityValue">80%</span>
        </label>
      </div>

      <div class="stats-panel" id="statsPanel">
        <div class="stat-row"><span class="stat-label">MÃ­n:</span><span class="stat-value" id="statMin">-</span></div>
        <div class="stat-row"><span class="stat-label">MÃ¡x:</span><span class="stat-value" id="statMax">-</span></div>
        <div class="stat-row"><span class="stat-label">Media:</span><span class="stat-value" id="statMean">-</span></div>
        <canvas id="histogramCanvas" width="280" height="50"></canvas>
      </div>
    </div>

    <div class="section">
      <h3>ğŸ—ºï¸ Mapa Base</h3>
      <div class="btn-group">
        <button class="basemap-btn active" data-basemap="osm">OSM</button>
        <button class="basemap-btn" data-basemap="satellite">SatÃ©lite</button>
        <button class="basemap-btn" data-basemap="pnoa">PNOA</button>
      </div>
    </div>

    <div class="section">
      <h3>ğŸ› ï¸ Herramientas</h3>
      <div class="btn-group">
        <button id="measureBtn" title="Medir distancia entre dos puntos">ğŸ“ Medir</button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.8.0/proj4.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4leaflet/1.0.2/proj4leaflet.min.js"></script>
  <script src="config.js"></script>
  <script src="app.js"></script>
</body>
</html>
